# 新選組エージェント間コミュニケーション規約

## 役職体系

| 役職 | 役割 | 通信における立場 |
|------|------|----------------|
| 局長 | ユーザー | 最終決定権者。副長が局長に判断を仰ぐ |
| 副長 | チームリーダー（スキル実行者） | 全通信の中継点。隊員への指示と局長への報告 |
| 隊士（一番隊〜N番隊） | 実装担当 | 副長に報告。他の隊員との直接通信は不可 |
| 監察方 | コードレビュー担当 | 副長に報告。他の隊員との直接通信は不可 |
| 目付方 | QAテスト担当 | 副長に報告。他の隊員との直接通信は不可 |

## 基本原則

- すべてのエージェント間通信はSendMessageツールを使用する
- 副長を経由してコミュニケーションする
- タスク状態の更新はTaskUpdateで行う

## メッセージ送信ルール

### 副長への報告

エージェントは副長に対して以下のタイミングで報告します:

1. **タスク開始時**: タスクに着手した旨を報告
2. **タスク完了時**: 成果物と結果を報告
3. **問題発生時**: ブロッカーや不明点を報告
4. **修正完了時**: フィードバックへの対応結果を報告

### エージェント間の直接通信

- エージェント同士の直接通信は原則として行わない
- 副長が仲介してメッセージを伝達する

## 報告フォーマット

### 隊士の報告

#### 実装完了報告

```
実装完了: [タスク名]
変更ファイル: [変更したファイルのリスト]
変更概要: [何をどう変更したかの簡潔な説明]
注意事項: [監察方に確認してほしいポイントがあれば]
```

#### 修正完了報告

```
修正完了: [指摘ID/内容]
変更ファイル: [変更したファイルのリスト]
対応内容: [どのように修正したかの説明]
```

### 監察方の報告

#### レビュー完了報告

```
レビュー完了: [タスク名]
判定: [APPROVE / REQUEST_CHANGES]

指摘事項:
- [重要度: critical/major/minor] [ファイル:行] 内容
- [重要度: critical/major/minor] [ファイル:行] 内容

良い点:
- [特筆すべき良い実装があれば]

総評: [全体的な評価コメント]
```

### 目付方の報告

#### QAテスト完了報告

```
QAテスト完了: [タスク名]
判定: [PASS / FAIL]

テスト結果サマリー:
- 実行テストケース数: N
- 成功: N
- 失敗: N

バグ報告:
- [重要度: critical/major/minor] [テストケースID] 内容
  再現手順: [手順の簡潔な説明]
  期待結果: [期待される動作]
  実際の結果: [実際の動作]

合格したテスト:
- [テストケースID] [テスト名]
```

## フィードバックループのフロー

```
1. 監察方/目付方 → 副長: 指摘/バグ報告
2. 副長: 指摘を整理し、修正タスクを作成
3. 副長 → 隊士: 修正を指示（SendMessage）
4. 隊士: 修正を実施
5. 隊士 → 副長: 修正完了報告
6. 副長 → 監察方/目付方: 再確認を指示（SendMessage）
7. 監察方/目付方: 再確認を実施
8. 監察方/目付方 → 副長: 再確認結果を報告
```

- フィードバックループは最大3回まで
- 3回で解決しない場合、副長は局長に判断を仰ぐ

## 重要度定義

| 重要度 | 説明 | 対応 |
|--------|------|------|
| critical | セキュリティ脆弱性、データ損失リスク、主要機能の障害 | 修正必須 |
| major | 設計上の問題、パフォーマンス劣化、重要な不具合 | 修正を強く推奨 |
| minor | 命名改善、コードスタイル、軽微なUI問題 | 記録のみ、修正任意 |
