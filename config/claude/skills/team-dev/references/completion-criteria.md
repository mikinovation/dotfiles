# 完了基準と品質ゲート

## 役職体系

- **局長**: ユーザー（最終決定権者）
- **副長**: チームリーダー（スキル実行者）
- **隊士（一番隊〜N番隊）**: 実装担当
- **監察方**: コードレビュー担当
- **目付方**: QAテスト担当

## タスクレベルの完了基準

### 隊士の実装タスク

以下をすべて満たした時点で完了とする:

- [ ] 要件で指定された機能が実装されている
- [ ] 既存のテストが通る（テストがある場合）
- [ ] 既存コードのスタイルとパターンに従っている
- [ ] セキュリティ上の問題がない（インジェクション、XSS等）
- [ ] 副長に完了報告が送信されている
- [ ] TaskUpdateでステータスがcompletedになっている
- [ ] **型チェック・lint・formatterは実行しないこと**（監察方の責務）

### 監察方のレビュータスク

以下をすべて満たした時点で完了とする:

- [ ] 対象コードの全変更差分を確認した
- [ ] コード品質・設計・セキュリティ・パフォーマンスの観点でレビューした
- [ ] **プロジェクトのCLAUDE.mdやREADMEを確認し、型チェック・lint・formatterのコマンドが定義されていれば実行した**
- [ ] 型チェック・lint・format違反があれば指摘事項に含めた
- [ ] 判定結果（APPROVE / REQUEST_CHANGES）を決定した
- [ ] 指摘事項に重要度を付与した
- [ ] 副長に完了報告が送信されている
- [ ] TaskUpdateでステータスがcompletedになっている

### 目付方のQAテストタスク

以下をすべて満たした時点で完了とする:

- [ ] テストケースを設計した
- [ ] すべてのテストケースを実行した
- [ ] 判定結果（PASS / FAIL）を決定した
- [ ] バグがあれば重要度付きで報告した
- [ ] 副長に完了報告が送信されている
- [ ] TaskUpdateでステータスがcompletedになっている

## フェーズレベルの品質ゲート

### 実装フェーズ → レビュー＆QAフェーズへの移行条件

- すべての隊士の実装タスクが完了していること
- 隊士からの完了報告をすべて受領していること

### レビュー＆QAフェーズ → フィードバックループまたは完了への移行条件

- すべての監察方のレビュータスクが完了していること
- すべての目付方のQAテストタスクが完了していること
- 指摘・バグ報告の有無が判明していること

### フィードバックループの終了条件

以下のいずれかを満たした場合にループを終了する:

1. **全指摘解消**: critical/major の指摘がすべて修正され、再確認でAPPROVE/PASSとなった
2. **ループ上限到達**: 3回のフィードバックループを実施した
3. **局長判断**: 局長が残存指摘を受け入れて続行を指示した

## プロジェクトレベルの完了基準

以下をすべて満たした時点でプロジェクト完了とする:

- [ ] すべての隊士の実装タスクが完了している
- [ ] すべての監察方のレビュータスクが完了している
- [ ] すべての目付方のQAテストタスクが完了している
- [ ] critical の指摘がゼロである
- [ ] major の指摘がすべて対応済みである（修正 or 局長承認で除外）
- [ ] 最終レポートが局長に提出されている
- [ ] すべてのエージェントがshutdownされている
- [ ] チームリソースがクリーンアップされている
