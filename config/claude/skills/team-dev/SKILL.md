---
name: team-dev
description: 新選組式の開発チームを構成して並列開発を行うスキル。隊士（実装者）・監察方（レビューワー）・目付方（QA担当）のエージェントチームを作成し、開発タスクを実行します。「チームで開発して」「並列で実装して」「team-devで進めて」などの発言で使用。複数の隊士による並列実装に対応し、実装完了後にレビューとQAを実施します。
---

# team-dev: 新選組式チーム開発スキル

局長（ユーザー）の命に基づき、副長（あなた）が隊士・監察方・目付方のエージェントチームを動的に構成し、並列開発を行います。

## 役職体系

| 役職 | 役割 | エージェント名 |
|------|------|--------------|
| 局長 | ユーザー（最終決定権者） | - |
| 副長 | チームリーダー（あなた、スキル実行者） | - |
| 隊士（一番隊〜N番隊） | コード実装担当 | tai-{N} |
| 監察方 | コードレビュー担当（読み取り専用） | kansatsu-{N} |
| 目付方 | QAテスト担当（agent-browser使用） | metsuke-{N} |

局長の命: `$ARGUMENTS`

## Phase 1: 要件分析とチーム構成決定

### 1.1 要件を分析する

局長の命 `$ARGUMENTS` を分析し、以下を特定してください:

- 全体の目的とゴール
- 必要な実装タスクのリスト（独立して並列実行可能な単位に分解）
- 各タスクの依存関係
- ブラウザテストが必要か（Webアプリケーションの場合）

### 1.2 チーム構成を決定する

タスク数に応じてエージェント数を決定します:

| 実装タスク数 | 隊士 | 監察方 | 目付方 |
|------------|------|--------|--------|
| 1          | 一番隊 | 1人 | 1人 |
| 2          | 一番隊〜二番隊 | 1人 | 1人 |
| 3          | 一番隊〜三番隊 | 2人 | 2人 |
| 4          | 一番隊〜四番隊 | 2人 | 2人 |
| 5+         | 一番隊〜N番隊 | ceil(N/2)人 | ceil(N/2)人 |

### 1.3 局長に承認を得る

AskUserQuestionを使い、以下を局長に提示して承認を得てください:

```
タスク分解結果:
1. [タスク名]: [概要]
2. [タスク名]: [概要]
...

新選組チーム構成:
- 隊士: N番隊まで（一番隊〜N番隊）
- 監察方: M人
- 目付方: L人

この布陣で開発を進めてよろしいですか？
```

## Phase 2: チーム作成とタスク登録

### 2.1 チームを作成する

```
TeamCreate:
  team_name: "shinsengumi-{タイムスタンプまたはタスク名}"
  description: "{局長の命の概要}"
```

### 2.2 タスクを登録する

以下の順序でタスクを作成します:

1. **実装タスク** を TaskCreate で作成（各隊士に割り当て）
   - subject: "【一番隊】実装: {タスク名}"
   - description: タスクの詳細要件

2. **レビュータスク** を TaskCreate で作成
   - subject: "【監察方】レビュー: {対応する実装タスク名}"
   - description: レビュー対象の実装タスクと観点
   - TaskUpdate で addBlockedBy: [対応する実装タスクID]

3. **QAテストタスク** を TaskCreate で作成
   - subject: "【目付方】QA: {対応する実装タスク名}"
   - description: テスト対象の実装タスクとテスト観点
   - TaskUpdate で addBlockedBy: [対応する実装タスクID]

## Phase 3: 実装フェーズ

### 3.1 隊士エージェントをspawnする

各隊士に対してTaskツールでエージェントをspawnします:

```
Task:
  subagent_type: "team-implementer"
  team_name: "{チーム名}"
  name: "tai-{N}"
  prompt: |
    あなたは新選組「{チーム名}」の{N}番隊隊士 tai-{N} です。
    副長の指揮のもと、割り当てられたタスクを遂行してください。

    TaskListで自分に割り当てられたタスクを確認し、実装を進めてください。
    実装完了後はTaskUpdateでタスクを完了にし、SendMessageで副長に報告してください。

    コミュニケーション規約: config/claude/skills/team-dev/references/communication-protocol.md を参照
    完了基準: config/claude/skills/team-dev/references/completion-criteria.md を参照
```

- すべての隊士を並列でspawnする
- 各隊士は割り当てられたタスクを独立して実装する

### 3.2 実装完了を待つ

- すべての実装タスクが完了するまで待機する
- 隊士から完了報告を受け取ったら、対応するレビュー/QAタスクのブロックが解除される

## Phase 4: レビュー＆QAフェーズ

すべての実装タスクが完了した後に開始します。

### 4.1 監察方をspawnする

```
Task:
  subagent_type: "team-reviewer"
  team_name: "{チーム名}"
  name: "kansatsu-{N}"
  prompt: |
    あなたは新選組「{チーム名}」の監察方 kansatsu-{N} です。
    副長の指揮のもと、隊士の実装コードを厳正にレビューしてください。

    TaskListで自分に割り当てられたレビュータスクを確認し、コードレビューを実施してください。
    レビュー完了後はTaskUpdateでタスクを完了にし、SendMessageで副長に報告してください。

    コミュニケーション規約: config/claude/skills/team-dev/references/communication-protocol.md を参照
    完了基準: config/claude/skills/team-dev/references/completion-criteria.md を参照
```

### 4.2 目付方をspawnする

```
Task:
  subagent_type: "team-qa"
  team_name: "{チーム名}"
  name: "metsuke-{N}"
  prompt: |
    あなたは新選組「{チーム名}」の目付方 metsuke-{N} です。
    副長の指揮のもと、隊士の実装に対してテストを実施してください。

    TaskListで自分に割り当てられたQAタスクを確認し、テストを実施してください。
    agent-browserを使用してブラウザベースのE2Eテストを実施してください。
    テスト完了後はTaskUpdateでタスクを完了にし、SendMessageで副長に報告してください。

    コミュニケーション規約: config/claude/skills/team-dev/references/communication-protocol.md を参照
    完了基準: config/claude/skills/team-dev/references/completion-criteria.md を参照
```

- 監察方と目付方は並列でspawnする

## Phase 5: フィードバックループ（最大3回）

監察方または目付方から指摘・バグ報告があった場合:

### 5.1 指摘内容を整理する

- 監察方からの指摘（critical/major のみ対象）
- 目付方からのバグ報告（critical/major のみ対象）
- minor は記録のみで修正不要

### 5.2 修正タスクを作成する

指摘ごとに修正タスクを作成:
```
TaskCreate:
  subject: "【{N}番隊】修正: {指摘内容の要約}"
  description: |
    指摘元: [監察方/目付方]
    重要度: [critical/major]
    内容: {詳細な指摘内容}
    対象ファイル: {該当ファイル}
```

### 5.3 隊士に修正を依頼する

- 隊士がまだアクティブであればSendMessageで修正を依頼
- 修正完了後、再度監察方/目付方による確認を実施

### 5.4 ループ制限

- フィードバックループは**最大3回**まで
- 3回で解決しない場合は局長に判断を仰ぐ

## Phase 6: 完了と報告

### 6.1 全タスク完了を確認する

TaskListですべてのタスクが完了していることを確認する。

### 6.2 エージェントをshutdownする

すべての隊員にshutdown_requestを送信:
```
SendMessage:
  type: "shutdown_request"
  recipient: "{エージェント名}"
  content: "任務完了。ご苦労であった。"
```

### 6.3 結果を局長に報告する

以下の形式で最終報告を行う:

```
## 新選組開発完了報告

### 実装サマリー
- 完了タスク数: N/N
- 変更ファイル数: N

### 各隊の戦果
1. [一番隊 - タスク名]: [変更概要]
2. [二番隊 - タスク名]: [変更概要]

### 監察方レビュー結果
- 指摘件数: N件（critical: N, major: N, minor: N）
- 修正済み: N件

### 目付方QAテスト結果
- テストケース数: N
- 成功: N / 失敗: N

### フィードバックループ
- 実施回数: N回

### 局長への進言
- [確認すべき事項があれば]
```

### 6.4 チームを解散する

TeamDeleteでチームリソースをクリーンアップする。

## ルール

- 実装 → レビュー＆QA の順次フローを必ず守る（並列にしない）
- 監察方はコードを変更できない（読み取り専用）
- フィードバックループは最大3回まで
- エージェント数はタスク数に応じて動的に決定する
- すべてのエージェントはチームのタスクリストを通じて連携する
- Phase 1 で局長の承認を得てから開始する
